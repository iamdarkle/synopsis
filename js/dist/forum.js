(()=>{var s={n:e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},d:(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},o:(s,e)=>Object.prototype.hasOwnProperty.call(s,e),r:s=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})}},e={};(()=>{"use strict";s.r(e);const t=flarum.core.compat["forum/app"];var o=s.n(t);const n=flarum.core.compat["common/extend"],r=flarum.core.compat["forum/states/DiscussionListState"];var i=s.n(r);const c=flarum.core.compat["forum/components/DiscussionListItem"];var a=s.n(c);const p=flarum.core.compat["common/utils/string"],u=flarum.core.compat["tags/models/Tag"];var l=s.n(u);const f=flarum.core.compat["common/Model"];var h=s.n(f);const d=flarum.core.compat["forum/components/SettingsPage"];var y=s.n(d);const x=flarum.core.compat["common/components/FieldSet"];var g=s.n(x);const S=flarum.core.compat["common/utils/ItemList"];var b=s.n(S);const v=flarum.core.compat["common/components/Switch"];var w=s.n(v);const E=flarum.core.compat["common/utils/Stream"];var L=s.n(E);o().initializers.add("ianm-synopsis",(function(){o().initializers.has("flarum-tags")&&(l().prototype.richExcerpts=h().attribute("richExcerpts"),l().prototype.excerptLength=h().attribute("excerptLength")),(0,n.extend)(i().prototype,"requestParams",(function(s){"first"===o().forum.attribute("synopsis.excerpt_type")?s.include.push("firstPost"):s.include.push("lastPost")})),(0,n.extend)(a().prototype,"infoItems",(function(s){var e,t,n,r,i=this.attrs.discussion;if(!o().session.user||o().session.user.preferences().showSynopsisExcerpts){var c,a=i.tags();a&&(c=a[a.length-1]);var u="first"===o().forum.attribute("synopsis.excerpt_type")?i.firstPost():i.lastPost(),l="number"==typeof(null==(e=c)?void 0:e.excerptLength())?null==(t=c)?void 0:t.excerptLength():o().forum.attribute("synopsis.excerpt_length"),f="number"==typeof(null==(n=c)?void 0:n.richExcerpts())?null==(r=c)?void 0:r.richExcerpts():o().forum.attribute("synopsis.rich_excerpts"),h=!!o().session.user&&o().session.user.preferences().showSynopsisExcerptsOnMobile;if(0!==l&&null!=u&&null!=u.contentHtml&&u.contentHtml()){var d=f?m.trust((0,p.truncate)(u.contentHtml(),l)):(0,p.truncate)(u.contentPlain(),l);if(u){var y=m("div",null,d);s.add(h?"excerptM":"excerpt",y,-100)}}}})),(0,n.extend)(y().prototype,"oninit",(function(){this.showSynopsisExcerpts=L()(this.user.preferences().showSynopsisExcerpts),this.showSynopsisExcerptsOnMobile=L()(this.user.preferences().showSynopsisExcerptsOnMobile)})),(0,n.extend)(y().prototype,"settingsItems",(function(s){s.add("synopsis",g().component({label:o().translator.trans("ianm-synopsis.forum.user.settings.summaries-heading"),className:"Settings-Synopsis"},this.summariesItems().toArray()))})),y().prototype.summariesItems=function(){var s=this,e=new(b());return e.add("synopsis-excerpts",w().component({state:this.user.preferences().showSynopsisExcerpts,onchange:function(e){s.showSynopsisExcerptsLoading=!0,s.user.savePreferences({showSynopsisExcerpts:e}).then((function(){s.showSynopsisExcerptsLoading=!1,m.redraw()}))},loading:this.showSynopsisExcerptsLoading},o().translator.trans("ianm-synopsis.forum.user.settings.show-summaries"))),this.user.preferences().showSynopsisExcerpts&&e.add("synopsis-excerpts-mobile",w().component({state:this.user.preferences().showSynopsisExcerptsOnMobile,disabled:!this.user.preferences().showSynopsisExcerpts,onchange:function(e){s.showSynopsisExcerptsOnMobileLoading=!0,s.user.savePreferences({showSynopsisExcerptsOnMobile:e}).then((function(){s.showSynopsisExcerptsOnMobileLoading=!1,window.location.reload()}))},loading:this.showSynopsisExcerptsOnMobileLoading},o().translator.trans("ianm-synopsis.forum.user.settings.show-summaries-mobile"))),e}}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map